---
title: "Take-home_Ex01"
author: "Junseok K."
---

Install R Packages

```{r}
pacman:: p_load(ggplot2, ggiraph, ggstatsplot, rstatix, gt, patchwork, tidyverse, patchwork, ggdist, png, gganimate, dplyr, skimr, knitr, rstatix, gt)
```


Load the Data

```{r}
Parts <- read_csv("data/Participants.csv")
```

```{r}
Fin <- read_csv("data/FinancialJournal.csv")
```
Data Prep

#Make EducationLevel, interestGroup, category, and Household Size as Factors



```{r}
#| code-fold: true
#| code-summary: "Show code"

Parts <- Parts %>%
  mutate(educationLevel = as.factor(educationLevel))

Parts <- Parts %>%
  mutate(householdSize = as.factor(householdSize))

Parts <- Parts %>%
  mutate(interestGroup = as.factor(interestGroup))

Parts <- Parts %>%
  mutate(participantId = as.integer(participantId))

Fin <- Fin %>%
  mutate(category = as.factor(category))
```


#DateTime transformation


```{r}
#| code-fold: true
#| code-summary: "Show code"

Fin$Month_Yr <- format(as.Date(Fin$timestamp), "%Y-%m")
```


#Pivot Columns

```{r}
#| code-fold: true
#| code-summary: "Show code"

Fin_Final <- Fin %>%
  group_by(participantId, category) %>%
  summarise(amount = sum(amount)) %>%
  pivot_wider(names_from = category, values_from = amount)
  
```
#Change NA to 0

```{r}
#| code-fold: true
#| code-summary: "Show code"

Fin_Final[is.na(Fin_Final)] <- 0
```


#Add new columns Cost_of_living, Total_Income, and Total_Savings
```{r}
#| code-fold: true
#| code-summary: "Show code"

Fin_Final <- Fin_Final %>%
   mutate(Cost_of_living = Education + Food + Recreation + Shelter)

Fin_Final <- Fin_Final %>%
   mutate(Total_Income = Wage + RentAdjustment)

Fin_Final <- Fin_Final %>%
   mutate(Total_Savings = Cost_of_living + Total_Income)

```


#Combine 2 tables together

```{r}
#| code-fold: true
#| code-summary: "Show code"

combined_table <- merge(Parts, Fin_Final, by = "participantId")
```

```{r}
#| code-fold: true
#| code-summary: "Show code"

kable(head(combined_table), "simple")
```

#Skim the Combined Table

```{r}
#| code-fold: true
#| code-summary: "Show code"

skimr::skim(combined_table)
```



#Export file
```{r}
write.csv(combined_table, "combined_table.csv", row.names = FALSE)
```


#QQ Line test to test normality

```{r}
#| code-fold: true
#| code-summary: "Show code"

ggplot(combined_table,
       aes(sample=Total_Savings)) +
  stat_qq()
  stat_qq_line()
```
#QQ Stats - based on the result below (the low p value and the fat that the points are not aligned well with the stright line), 
we are unable to confirm normality assumption on the Total_Savings distribution. 
Therefore, non-parametric test will be used for hypthesis testing. Note that the null hypothesis is no difference between 
Total_Savings between different education levels

```{r}
#| code-fold: true
#| code-summary: "Show code"

qq <- ggplot(combined_table,
             aes(sample=Total_Savings)) +
  stat_qq() +
  stat_qq_line()

sw_t <- combined_table %>%
  shapiro_test(Total_Savings) %>%
  gt()

tmp<- tempfile(fileext = '.png')
gtsave(sw_t, tmp)
table_png <- png::readPNG(tmp,native = TRUE)

qq + table_png
```


#Median is used instead of mean, because i could not get a chance to check the outliers due to time constraints.

```{r}

#Order of Education variables by median of Total_Savings

# Create a boxplot
ggplot(combined_table, aes(x=educationLevel, y=Total_Savings)) +
  geom_boxplot()


# Perform non-parametric ANOVA test
kruskal.test(Total_Savings ~ educationLevel, data = combined_table)

```

